<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Alaska Flight Status</title>
  <style>
    :root {
      --bg-color: #ffffff;
      --text-color: #000000;
      --input-bg: #f5f5f5;
      --button-bg: #00427a;
      --button-text: #ffffff;
      --badge-bg: #e0e0e0;
      --badge-text: #000000;
      --delete-btn-color: red;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg-color: #121212;
        --text-color: #f0f0f0;
        --input-bg: #1e1e1e;
        --button-bg: #0077cc;
        --button-text: #ffffff;
        --badge-bg: #333333;
        --badge-text: #f0f0f0;
        --delete-btn-color: #ff6b6b;
      }
    }

    body {
      font-family: sans-serif;
      padding: 2em;
      max-width: 400px;
      margin: auto;
      background-color: var(--bg-color);
      color: var(--text-color);
    }

    *, *::before, *::after {
      box-sizing: border-box;
    }

    input[type="text"],
    select,
    button {
      width: 100%;
      padding: 0.8em;
      margin: 0.5em 0;
      font-size: 1em;
      border: none;
      border-radius: 5px;
      background-color: var(--input-bg);
      color: var(--text-color);
    }

    button {
      background-color: var(--button-bg);
      color: var(--button-text);
      cursor: pointer;
    }

    button:hover {
      opacity: 0.9;
    }

    .checkbox-wrapper {
      background-color: var(--input-bg);
      color: var(--text-color);
      border-radius: 5px;
      padding: 0.8em;
      margin: 0.5em 0;
      display: flex;
      align-items: center;
      gap: 0.5em;
    }

    .checkbox-wrapper input[type="checkbox"] {
      width: auto;
      margin: 0;
    }

    .checkbox-wrapper label {
      margin: 0;
      font-size: 0.95em;
    }

    #searchHistory {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5em;
      margin-bottom: 1em;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 13px 10px;
      background-color: var(--badge-bg);
      color: var(--badge-text);
      border-radius: 5px;
      cursor: pointer;
      position: relative;
    }

    .delete-btn {
      margin-left: 10px;
      color: var(--delete-btn-color);
      cursor: pointer;
      position: absolute;
      right: 3px;
      top: 0px;
    }
  </style>
</head>
<body>
  <h2>Alaska Flight Status</h2>
  <p style="font-size: 0.8em; font-weight: normal; color: gray; margin-top: -0.5em; margin-bottom: 1em;">
    Description: Alaska Airlines creates unique flight status pages for every flight. They are created 4 days in advance and live for 2â€“3 days after the flight. Enter the flight number and choose Today, Tomorrow, etc., then click Check Status to open that specific flight status page.
  </p>
  <label for="flight">Flight Number:</label>
  <input type="text" id="flight" inputmode="numeric" placeholder="e.g., 331" required autofocus />
  <div class="checkbox-wrapper">
    <input type="checkbox" id="remember" />
    <label for="remember">Remember this flight number</label>
  </div>
  <label for="offset">Date:</label>
  <select id="offset">
    <option value="-3">3 Days ago</option>
    <option value="-2">2 Days ago</option>
    <option value="-1">Yesterday</option>
    <option value="0" selected>Today</option>
    <option value="1">Tomorrow</option>
    <option value="2">2 Days from now</option>
    <option value="3">3 Days from now</option>
    <option value="4">4 Days from now</option>
  </select>

  <p id="warningMessage" style="color:orange; font-size:0.9em; display:none;"></p>
  <div id="searchHistory"></div>

  <button onclick="lookupFlight()">Check Status</button>

  <script>
    window.addEventListener("DOMContentLoaded", () => {
      initializeFlightInput();
      displaySearchHistory();
    });

    function initializeFlightInput() {
      const savedFlight = localStorage.getItem('savedFlight');
      const flightInput = document.getElementById('flight');
      const rememberBox = document.getElementById('remember');
      const offsetSelect = document.getElementById('offset');
      const warningMessage = document.getElementById('warningMessage');

      if (savedFlight) {
        flightInput.value = savedFlight;
        rememberBox.checked = true;
      }

      rememberBox.addEventListener('change', () => {
        if (!rememberBox.checked) {
          localStorage.removeItem('savedFlight');
          flightInput.value = '';
        }
      });

      offsetSelect.addEventListener('change', () => {
        const offset = parseInt(offsetSelect.value);
        if (offset === 4) {
          const now = new Date();
          const futureDate = new Date(now);
          futureDate.setDate(now.getDate() + 4);
          const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
          const timeOptions = { hour: 'numeric', minute: '2-digit', hour12: true };
          const formattedDate = futureDate.toLocaleDateString(undefined, dateOptions);
          const formattedTime = now.toLocaleTimeString(undefined, timeOptions);
          warningMessage.textContent = `Flight status pages for ${formattedDate} departing after ${formattedTime} may not yet be available.`;
          warningMessage.style.display = 'block';
        } else {
          warningMessage.style.display = 'none';
        }
      });
    }

    function displaySearchHistory() {
      const searchHistoryDiv = document.getElementById('searchHistory');
      const searches = JSON.parse(localStorage.getItem('searches') || '[]');

      searches.forEach(search => {
        const [flight, offset] = search.split('|');
        const badge = createSearchBadge(flight, offset, searches);
        searchHistoryDiv.appendChild(badge);
      });
    }

    function createSearchBadge(flight, offset, searches) {
      const badge = document.createElement('span');
      const offsetText = offset == 0 ? 'today' : (offset > 0 ? `+${offset} days` : `${offset} days`);
      badge.textContent = `AS ${flight}, ${offsetText}`;
      badge.classList.add('badge');

      const deleteBtn = createDeleteButton(flight, offset, searches, badge);
      badge.appendChild(deleteBtn);

      badge.addEventListener('click', () => {
        navigateToFlightStatus(flight, offset);
      });

      return badge;
    }

    function createDeleteButton(flight, offset, searches, badge) {
      const deleteBtn = document.createElement('span');
      deleteBtn.textContent = 'x';
      deleteBtn.classList.add('delete-btn');

      deleteBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        const updatedSearches = searches.filter(s => s !== `${flight}|${offset}`);
        localStorage.setItem('searches', JSON.stringify(updatedSearches));
        badge.remove();
      });

      return deleteBtn;
    }

    function navigateToFlightStatus(flight, offset) {
      const date = new Date();
      date.setDate(date.getDate() + parseInt(offset));
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      const formattedDate = `${year}-${month}-${day}`;
      const url = `https://www.alaskaair.com/status/${flight}/${formattedDate}`;
      window.location.href = url;
    }

    function lookupFlight() {
      const flightInput = document.getElementById("flight");
      const flight = flightInput.value.trim();
      const offset = parseInt(document.getElementById("offset").value);
      const remember = document.getElementById("remember").checked;

      if (!/^\d+$/.test(flight) || !( (flight >= 0 && flight <= 3500) || (flight >= 9000 && flight <= 9999) )) {
        alert("Please enter a valid flight number (0-3500 or 9000-9999).");
        return;
      }

      if (remember) {
        localStorage.setItem('savedFlight', flight);
      } else {
        localStorage.removeItem('savedFlight');
      }

      const searchTerm = `${flight}|${offset}`;
      let existingSearches = JSON.parse(localStorage.getItem('searches') || '[]');

      if (!existingSearches.includes(searchTerm)) {
        existingSearches.push(searchTerm);
        if (existingSearches.length > 5) {
          existingSearches.shift();
        }
        localStorage.setItem('searches', JSON.stringify(existingSearches));
      }

      navigateToFlightStatus(flight, offset);
    }
  </script>

  <div style="text-align:center; font-size:0.85em; color:gray; margin-top:1em;">
    <p>
      This tool is unofficial and not affiliated with Alaska Airlines. Always confirm flight details at
      <a href="https://www.alaskaair.com/" target="_blank" style="color:inherit; text-decoration:underline;">alaskaair.com</a>.
    </p>
    <p>
      View the source code on
      <a href="https://github.com/heykid6063/Alaska-Flight-Status" target="_blank" style="color:inherit; text-decoration:underline;">
        GitHub
      </a>.
    </p>
  </div>
  <p id="lastUpdated" style="text-align:center; font-size:0.75em; font-style:italic; margin-top:2em; color:gray;"></p>
  <script>
    const lastModified = new Date(document.lastModified);
    const options = {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: 'numeric',
      minute: '2-digit',
      hour12: true
    };
    const formatted = lastModified.toLocaleString(undefined, options);
    document.getElementById('lastUpdated').textContent = "Page design last updated on: " + formatted;
  </script>
</body>
</html>
